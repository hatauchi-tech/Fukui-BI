# 福井鐵工株式会社 損益計算書可視化BIツール 要件定義書

## 1. プロジェクト概要

### 1.1 目的
福井鐵工株式会社の損益計算書データを可視化し、部課別の業績把握と経営判断の迅速化を図る。

### 1.2 背景
- 損益計算書データはCSV形式で管理されており、月次で出力される
- 部課別・科目別の業績推移を視覚的に把握したい
- 複数月のデータを蓄積し、時系列での分析を可能にしたい

### 1.3 対象データ
| ファイル名 | 概要 |
|-----------|------|
| 経営指標可視化DB - 損益計算書.csv | 部課別の損益計算書データ（売上、原価、販管費、利益等） |

### 1.4 データ運用方法
- プロジェクト内に「損益計算書」フォルダを配置
- 月に一度、CSVファイルを保存（例: `2025_07_損益計算書.csv`）
- アプリはフォルダ内の全CSVを読み込み、時系列データとして集計

---

## 2. データ構造

### 2.1 CSVカラム定義（23列）

| # | カラム名 | 説明 | データ型 |
|---|---------|------|---------|
| 1 | 事業所ｺｰﾄﾞ | 事業所の識別コード | 数値 |
| 2 | 事業所名 | 事業所の正式名称 | 文字列 |
| 3 | 事業所略名 | 事業所の略称 | 文字列 |
| 4 | 部課ｺｰﾄﾞ | 部課の識別コード | 数値 |
| 5 | 部課名 | 部課の正式名称 | 文字列 |
| 6 | 部課略名 | 部課の略称 | 文字列 |
| 7 | 出力帳票 | 帳票区分 | 数値 |
| 8 | 改頁№ | ページ番号 | 数値 |
| 9 | SEQNO | 行の順序番号 | 数値 |
| 10 | 科目ｺｰﾄﾞ | 勘定科目の識別コード | 数値 |
| 11 | 補助ｺｰﾄﾞ | 補助科目の識別コード | 数値 |
| 12 | 科目名 | 勘定科目の名称 | 文字列 |
| 13 | 補助科目名 | 補助科目の名称 | 文字列 |
| 14 | 科目略名 | 科目の略称 | 文字列 |
| 15 | 貸借区分 | 借方/貸方の区分 | 数値 |
| 16 | 属性区分 | 科目の属性区分 | 数値 |
| 17 | 罫線区分 | 表示用罫線区分 | 数値 |
| 18 | 前残高 | 前月までの累計残高 | 数値 |
| 19 | 借方 | 当月借方金額 | 数値 |
| 20 | 貸方 | 当月貸方金額 | 数値 |
| 21 | 残高 | 当月末残高（前残高+借方-貸方 or 前残高-借方+貸方） | 数値 |
| 22 | 開始年月 | 対象期間の開始年月 | 日付(YYYY/MM) |
| 23 | 終了年月 | 対象期間の終了年月 | 日付(YYYY/MM) |

### 2.2 部課一覧（8部門）

| 部課ｺｰﾄﾞ | 部課名 |
|---------|-------|
| 210 | 建機事業部 |
| 220 | 社会インフラ製作 |
| 230 | 社会インフラ架設 |
| 240 | 特機 |
| 250 | 民間リピート製作 |
| 260 | その他製作 |
| 270 | わかえ共通 |
| 900 | 共通 |

### 2.3 主要科目体系

```
Ｉ 売上高
├── 工事売上高
├── その他売上高
├── 賃貸料収入
├── その他売上高（工事外）
└── 売上値引き戻り高
【収入計】

Ⅱ 売上原価
├── 期首棚卸高
├── 【当期製品製造原価】
│   ├── (製)材料費
│   ├── (製)労務費計（賃金、賞与、法定福利費、福利厚生費、退職金等）
│   └── (製)経費計（外注費、運搬費、減価償却費、修繕費、水道光熱費等）
└── 期末棚卸高
【売上原価】

【売上総利益】

【販売費及び一般管理費】
├── 役員報酬、給料、賞与
├── 法定福利費、福利厚生費
├── 旅費交通費、通信費
├── 広告宣伝費、接待交際費
├── 減価償却費、修繕費
├── 地代家賃、リース料
└── その他経費

【営業利益】

【営業外収益】（受取利息、受取配当金、雑収入等）
【営業外費用】（支払利息、雑損失等）

【経常利益】

【特別利益】（固定資産売却益、有価証券売却益等）
【特別損失】（固定資産除却損、前期損益修正損等）

【税引前当期利益】
法人税、住民税及び事業税
【当期利益】
```

---

## 3. 利用者と要求機能

### 3.1 利用者区分

| 利用者 | 主な利用目的 |
|--------|-------------|
| 経営層・役員 | 全社業績の俯瞰、部門間比較 |
| 部門長・管理職 | 自部門の業績管理、コスト分析 |
| 経理・財務担当 | 詳細分析、データ確認 |

---

## 4. 機能要件

### 4.1 データ管理機能

#### 4.1.1 CSVファイル管理
- 「損益計算書」フォルダ内のCSVを自動検出・読み込み
- ファイル名から対象年月を推定（例: `2025_07_損益計算書.csv` → 2025年7月）
- 複数月のデータを統合して時系列分析可能

#### 4.1.2 データバリデーション
- CSVフォーマットの整合性チェック
- 必須カラムの存在確認
- 数値データの型チェック

### 4.2 ダッシュボード機能

#### 4.2.1 全社サマリー（トップ画面）
- **主要KPIカード表示**
  - 売上高（当月/累計）
  - 売上総利益（当月/累計）
  - 営業利益（当月/累計）
  - 経常利益（当月/累計）
  - 当期利益（当月/累計）
- **売上総利益率・営業利益率・経常利益率**の表示
- **部門別売上構成比**（円グラフまたは棒グラフ）

#### 4.2.2 推移グラフ
- 月次売上高推移（折れ線グラフ）
- 月次利益推移（営業利益、経常利益、当期利益）
- 前年同月比較（データがある場合）

#### 4.2.3 部門別ダッシュボード
- 部門選択ドロップダウン
- 選択部門のKPIカード
- 選択部門の推移グラフ
- 部門間比較（複数部門選択時）

### 4.3 原価分析機能

#### 4.3.1 売上原価構成分析
- **製造原価の内訳表示**
  - 材料費
  - 労務費（賃金、賞与、法定福利費等）
  - 経費（外注費、運搬費、減価償却費等）
- 原価構成比の円グラフ
- 部門別原価比較

#### 4.3.2 販管費分析
- 販管費の内訳表示
- 主要販管費項目の推移
- 売上高販管費率の推移

### 4.4 詳細データ表示

#### 4.4.1 科目別一覧
- 部門・期間でフィルタリング可能なテーブル表示
- 科目名、前残高、借方、貸方、残高の表示
- ソート機能

#### 4.4.2 データエクスポート
- 表示中のデータをCSV出力

### 4.5 経営指標ガイド機能

#### 4.5.1 指標一覧・算出方法
- 各経営指標（KPI）の定義と計算式を表示
- 指標ごとの意味・目的の解説
- 業界標準値や目安の提示

#### 4.5.2 グラフの見方ガイド
- 各グラフの読み取り方の解説
- 注目すべきポイントの説明
- 異常値・警告サインの見分け方

#### 4.5.3 分析手法ガイド
- 時系列分析の方法
- 部門間比較の着眼点
- 原価構成分析のポイント
- 改善アクションへの繋げ方

#### 4.5.4 用語集
- 損益計算書の専門用語解説
- 勘定科目の説明

---

## 5. 画面構成

```
┌─────────────────────────────────────────────────────────────┐
│ 福井鐵工株式会社 損益計算書BIツール          [部門選択▼] [期間選択▼] │
├─────────────────────────────────────────────────────────────┤
│ [全社サマリー] [部門別分析] [原価分析] [詳細データ] [📖ガイド]     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐        │
│  │ 売上高    │ │売上総利益 │ │ 営業利益 │ │ 経常利益 │        │
│  │ ¥XXX,XXX │ │ ¥XXX,XXX │ │ ¥XXX,XXX │ │ ¥XXX,XXX │        │
│  │ (XX.X%)  │ │ (XX.X%)  │ │ (XX.X%)  │ │ (XX.X%)  │        │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘        │
│                                                             │
│  ┌─────────────────────────────┐ ┌─────────────────────────┐│
│  │     売上・利益推移グラフ      │ │   部門別売上構成比      ││
│  │         (折れ線)            │ │      (円グラフ)         ││
│  │                             │ │                         ││
│  └─────────────────────────────┘ └─────────────────────────┘│
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                  部門別比較 (棒グラフ)                    ││
│  └─────────────────────────────────────────────────────────┘│
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.1 タブ構成

| タブ名 | 内容 |
|-------|------|
| 全社サマリー | KPIカード、推移グラフ、部門構成比 |
| 部門別分析 | 部門選択による詳細表示、部門間比較 |
| 原価分析 | 製造原価内訳、販管費内訳、原価率推移 |
| 詳細データ | 科目別テーブル、フィルタ・ソート、CSV出力 |
| ガイド | 経営指標の算出方法、グラフの見方、分析手法、用語集 |

---

## 6. 技術スタック

| 技術 | 用途 |
|------|------|
| **Python 3.11+** | アプリケーション言語 |
| **tkinter** | GUIフレームワーク（標準ライブラリ） |
| **pandas** | CSVデータ処理・集計 |
| **matplotlib** | グラフ描画 |
| **ttkbootstrap**（オプション） | モダンなUI装飾 |

---

## 7. ディレクトリ構成

```
Fukui-BI/
├── 損益計算書BI.bat              # ★ダブルクリックで起動するバッチファイル
├── 損益計算書/                    # CSVデータ格納フォルダ
│   ├── 2025_07_損益計算書.csv
│   ├── 2025_08_損益計算書.csv
│   └── ...
├── src/
│   ├── main.py                   # エントリーポイント
│   ├── app.py                    # メインアプリケーション
│   ├── data_loader.py            # CSVデータ読み込み
│   ├── data_processor.py         # データ加工・集計
│   ├── views/
│   │   ├── dashboard.py          # 全社サマリー画面
│   │   ├── department.py         # 部門別分析画面
│   │   ├── cost_analysis.py      # 原価分析画面
│   │   ├── detail_view.py        # 詳細データ画面
│   │   └── guide.py              # 経営指標ガイド画面
│   └── components/
│       ├── kpi_card.py           # KPIカードコンポーネント
│       ├── charts.py             # グラフコンポーネント
│       └── data_table.py         # テーブルコンポーネント
├── requirements.txt
└── 要件定義書_損益計算書BI.md
```

### 7.1 起動用バッチファイル

**ファイル名**: `損益計算書BI.bat`

**動作仕様**:
- ダブルクリックでアプリケーションを起動
- コマンドプロンプトのウィンドウは非表示（GUIのみ表示）
- Pythonがインストールされていない場合はエラーメッセージを表示

**バッチファイル内容（例）**:
```batch
@echo off
cd /d "%~dp0"
pythonw src/main.py
if errorlevel 1 (
    echo エラーが発生しました。Pythonがインストールされているか確認してください。
    pause
)
```

**補足**:
- `pythonw` を使用することでコマンドプロンプトを非表示にする
- `%~dp0` でバッチファイルと同じディレクトリに移動
- エラー時のみメッセージを表示

---

## 8. 開発フェーズ

### Phase 1: MVP（最小実行可能製品）
1. CSVデータ読み込み機能
2. 全社サマリーダッシュボード（KPIカード）
3. 基本的な推移グラフ
4. 部門選択による絞り込み

### Phase 2: 分析機能強化
1. 部門別詳細分析
2. 原価構成分析
3. 部門間比較グラフ
4. 詳細データテーブル

### Phase 3: 運用機能
1. CSVエクスポート機能
2. 前年同期比較
3. UI/UX改善

---

## 9. 非機能要件

### 9.1 性能要件
- アプリ起動：5秒以内
- 画面切替：1秒以内
- グラフ描画：2秒以内

### 9.2 対応環境
- Windows 10/11
- Python 3.11以上がインストールされた環境

### 9.3 データ量想定
- 月次CSVファイル：約2,000行/月
- 保存期間：無制限（全履歴保持）
- 想定最大データ量：5年分（約120,000行）

---

## 10. 今後の拡張可能性

- 売上・原価報告書CSVとの統合分析
- 予算データとの予実比較機能
- PDF/Excelレポート出力
- exe化による配布（PyInstaller等）

---

## 付録: CSVファイル命名規則

推奨形式: `YYYY_MM_損益計算書.csv`

例:
- `2025_07_損益計算書.csv`
- `2025_08_損益計算書.csv`
- `2025_09_損益計算書.csv`

※ファイル名から年月を自動判定。判定できない場合はCSV内の「開始年月」「終了年月」カラムを使用。

---

## 付録B: 経営指標ガイド（アプリ内表示内容）

### B.1 主要経営指標の算出方法

#### 収益性指標

| 指標名 | 計算式 | 意味・目的 |
|-------|-------|-----------|
| **売上総利益率（粗利率）** | (売上高 - 売上原価) ÷ 売上高 × 100 | 製品・サービスの基本的な収益力を示す。製造効率や価格設定の妥当性を評価 |
| **営業利益率** | 営業利益 ÷ 売上高 × 100 | 本業での収益力を示す。販管費を含めた事業全体の効率性を評価 |
| **経常利益率** | 経常利益 ÷ 売上高 × 100 | 財務活動を含めた通常の企業活動の収益力を示す |
| **当期純利益率** | 当期利益 ÷ 売上高 × 100 | 最終的な収益力を示す。税引後の実質的な利益率 |

#### 原価・費用関連指標

| 指標名 | 計算式 | 意味・目的 |
|-------|-------|-----------|
| **売上原価率** | 売上原価 ÷ 売上高 × 100 | 売上に対する製造コストの割合。低いほど効率的 |
| **販管費率** | 販売費及び一般管理費 ÷ 売上高 × 100 | 売上に対する間接費用の割合。管理効率の指標 |
| **材料費率** | 材料費 ÷ 売上高 × 100 | 売上に対する材料費の割合。調達効率の指標 |
| **労務費率** | 労務費 ÷ 売上高 × 100 | 売上に対する人件費の割合。生産性の指標 |
| **外注費率** | 外注費 ÷ 売上高 × 100 | 売上に対する外注費の割合。内製/外注バランスの指標 |

### B.2 指標の目安・業界水準

| 指標 | 製造業一般 | 注意が必要な水準 |
|------|-----------|----------------|
| 売上総利益率 | 20〜30% | 15%未満 |
| 営業利益率 | 3〜8% | 0%以下（赤字） |
| 経常利益率 | 3〜7% | 0%以下（赤字） |
| 売上原価率 | 70〜80% | 85%超 |
| 販管費率 | 15〜25% | 30%超 |

※業界・企業規模により異なるため、自社の過去データとの比較を重視

### B.3 グラフの見方

#### 推移グラフ（折れ線グラフ）
- **上昇トレンド**: 右肩上がりは業績改善を示す
- **下降トレンド**: 右肩下がりは業績悪化の兆候
- **急激な変動**: 特殊要因（大型案件、一時的費用等）の可能性
- **季節変動**: 毎年同時期に同様のパターンがあれば季節性

#### 構成比グラフ（円グラフ・棒グラフ）
- **構成比の変化**: 前期比で大きく変動した項目に注目
- **偏り**: 特定部門・項目への過度な依存はリスク要因
- **バランス**: 複数の収益源がある状態が安定的

#### 部門比較グラフ
- **部門間格差**: 大きな差がある場合、要因分析が必要
- **ベストプラクティス**: 高収益部門の手法を他部門へ展開
- **改善ターゲット**: 低収益部門の課題特定

### B.4 分析のポイント

#### 時系列分析
1. **トレンド把握**: 3ヶ月以上の傾向を確認
2. **前年同月比較**: 季節要因を排除した比較
3. **異常値の特定**: 急激な変動の原因調査
4. **先行指標**: 売上は利益に先行することが多い

#### 部門間比較
1. **収益性の差**: なぜ差が生じているかを分析
2. **コスト構造**: 原価・販管費の構成比較
3. **改善余地**: 低収益部門の改善ポイント特定

#### 原価分析
1. **変動費vs固定費**: 売上変動への感応度把握
2. **材料費**: 調達価格、歩留まりの確認
3. **労務費**: 生産性、残業時間の確認
4. **外注費**: 内製化の検討余地

### B.5 改善アクションへの繋げ方

| 状況 | 考えられる原因 | 改善アクション例 |
|------|--------------|----------------|
| 売上総利益率低下 | 材料費高騰、価格競争 | 調達先見直し、価格転嫁、製品構成見直し |
| 営業利益率低下 | 販管費増加 | 固定費削減、業務効率化 |
| 部門間で利益率格差 | 案件特性、効率差 | ベストプラクティス共有、人員配置見直し |
| 売上減少 | 受注減、案件遅延 | 営業強化、顧客開拓 |
| 労務費率上昇 | 生産性低下、残業増 | 工程改善、設備投資、人員配置最適化 |

### B.6 用語集

| 用語 | 説明 |
|------|------|
| **売上高** | 企業の主たる営業活動から得られた収益の総額 |
| **売上原価** | 売上を得るために直接かかった費用（材料費、労務費、経費） |
| **売上総利益（粗利益）** | 売上高から売上原価を差し引いた利益 |
| **販売費及び一般管理費** | 販売活動・管理活動にかかる費用（人件費、広告費、事務費等） |
| **営業利益** | 売上総利益から販管費を差し引いた、本業での利益 |
| **営業外収益** | 本業以外から得られる収益（受取利息、配当金等） |
| **営業外費用** | 本業以外でかかる費用（支払利息等） |
| **経常利益** | 営業利益に営業外損益を加減した、経常的な活動による利益 |
| **特別利益** | 臨時的・例外的に発生した利益（固定資産売却益等） |
| **特別損失** | 臨時的・例外的に発生した損失（固定資産除却損等） |
| **税引前当期利益** | 経常利益に特別損益を加減した、税金控除前の利益 |
| **当期利益（純利益）** | 税金を差し引いた最終的な利益 |
| **借方** | 資産の増加・費用の発生を記録する側 |
| **貸方** | 負債・資本の増加・収益の発生を記録する側 |
| **前残高** | 前月末時点での累計残高 |
| **残高** | 当月末時点での累計残高 |
